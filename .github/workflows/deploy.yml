name: Test Deploy Laravel to Hostinger

on:
  push:
    branches: ["main"]  # Change if you push to a different branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout code
      - name: Checkout code
        uses: actions/checkout@v3

      # 2️⃣ Create ZIP of project (excluding .git folder)
      - name: Create ZIP
        run: zip -r deploy.zip . -x "*.git*"

      # 3️⃣ Upload ZIP to Hostinger
      - name: Upload to Hostinger
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER }}
          port: ${{ secrets.PORT }}
          key: ${{ secrets.KEY }}
          source: "deploy.zip"
          target: ${{ secrets.TARGET }}

      # 4️⃣ SSH into server and extract ZIP
      - name: Extract ZIP on Hostinger
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER }}
          port: ${{ secrets.PORT }}
          key: ${{ secrets.KEY }}
          script: |
            cd ${{ secrets.TARGET }}
            unzip -o deploy.zip
            rm deploy.zip
